Counter Strike 1.6 делаем wallhack

	В этой простой статье написано том как можно сделать простой OpenGL wallhack для 
игры  Counter Strike 1.6 с использованием Ollydbg.
      Достаточно иметь базовые знания ассемблера и OpenGL и уметь пользоваться Ollydbg.
Нам понадобятся константы из библиотеки OpenGL:
http://logand.com/mplisp/simul/gl/lib.l
Думаю не стоит лишний раз говорить что такое лучше делать на non-steam клиенте.


Часть 1. Самый простой способ.

Здесь мы будем использовать функцию glDepthFunc:
http://www.opengl.org/sdk/docs/man/xhtml/glDepthFunc.xml

Итак, эта функция позволяет указать условие для отрисовки пикселя основанное на расположении
одного объекта относительно другого (дальность). Она используется для того, чтобы объекты, находящиеся 
на большем расстоянии от "камеры", не попали на экран. Понятно, что изменив вызов этой функции, мы сможем
заставить программу рисовать пиксели которых быть не должно (те, что принадлежат объектам находящимся
за стеной). Приступим. Запустите клиент CS 1.6 и прикрепитесь к нему с помощью Ollydbg:
 
1.jpg

Если вы не остановились в модуле "hl", используйте "исполнение до кода программы" ("execute till user code").
Теперь найдем функцию glDepthFunc правым щелчком на окне дизассемблера ("search for" -> "name in all modules") и в появившемся окне найдем нашу функцию.

2.jpg

В этом окне поставим точку остановки на функции glDepthFunc. Теперь продолжим исполнение и подключимся к серверу. Остановимся здесь:

3.jpg

Теперь временно уберем эту точку остановки (в окне Breakpoints) и продолжим исполнение до кода программы 
"execute till user code". Остановимся здесь:

4.jpg

Заметим что единственным аргументом функции является константа 203.

#define GL_NEVER                          0x0200
#define GL_LESS                           0x0201
#define GL_EQUAL                          0x0202
#define GL_LEQUAL                         0x0203
#define GL_GREATER                        0x0204
#define GL_NOTEQUAL                       0x0205
#define GL_GEQUAL                         0x0206
#define GL_ALWAYS                         0x0207

Видим что OpenGL велено рисовать только те объекты, что имеют глубину (грубо - дальность)
меньшую или равную глубине того объекта, который уже нарисован. Заменим его на
GL_ALWAYS = 207. Подменим значение в коде, продолжим исполнение программы и снова подключимся к серверу.
Вы должны увидет что-то типа этого:

5.jpg

Вместо карты - каша, но если присмотреться, то видно, что многие стены удалены и за ними 
видны модельки. Это самый простой и худший способ.

Часть 2.
Найдем части кода которые ответствены за отрисовку моделей. 
